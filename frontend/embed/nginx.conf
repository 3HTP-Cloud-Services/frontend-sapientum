worker_processes 1;
error_log stderr;
pid /tmp/nginx.pid;
events {
    worker_connections 1024;
}
http {
    include /Users/jpnunez/aicompetency/svelte_flask/frontend/embed/mime.types;
    default_type application/octet-stream;
    sendfile on;
    keepalive_timeout 65;
    # Enable CORS
    add_header 'Access-Control-Allow-Origin' '*' always;
    add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
    add_header 'Access-Control-Allow-Headers' 'Origin, X-Requested-With, Content-Type, Accept' always;
    server {
        listen 7001;
        root /Users/jpnunez/aicompetency/svelte_flask/frontend/embed;
        index index.html;
        # Serve static files
        location / {
            try_files $uri $uri/ =404;
        }
        # Handle CORS preflight requests
        location = /cors-options {
            if ($request_method = 'OPTIONS') {
                add_header 'Access-Control-Allow-Origin' '*';
                add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
                add_header 'Access-Control-Allow-Headers' 'Origin, X-Requested-With, Content-Type, Accept';
                add_header 'Access-Control-Max-Age' 1728000;
                add_header 'Content-Type' 'text/plain charset=UTF-8';
                add_header 'Content-Length' 0;
                return 204;
            }
            return 404;
        }
        # Move the OPTIONS logic to a separate location block
        if ($request_method = 'OPTIONS') {
            rewrite ^ /cors-options last;
        }
        # Cache settings for better performance
        location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
            expires 7d;
            add_header Cache-Control "public, max-age=604800";
        }
    }
}
