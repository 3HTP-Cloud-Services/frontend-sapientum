<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sapientum AI Embed Test</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      color: #333;
    }
    
    h1, h2, h3 {
      margin-top: 1.5em;
      color: #2563eb;
    }
    
    .test-container {
      margin-bottom: 40px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 20px;
      background-color: #f9fafb;
    }
    
    .embed-container {
      margin-top: 20px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .test-actions {
      margin: 20px 0;
      padding: 15px;
      background-color: #f0f7ff;
      border-radius: 6px;
      border-left: 4px solid #3b82f6;
    }
    
    .test-result {
      margin-top: 20px;
      min-height: 100px;
      background-color: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 10px;
      font-family: monospace;
      white-space: pre-wrap;
    }
    
    button {
      padding: 8px 16px;
      margin-right: 8px;
      margin-bottom: 8px;
      background-color: #3b82f6;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.2s;
    }
    
    button:hover {
      background-color: #2563eb;
    }
    
    button.secondary {
      background-color: #6b7280;
    }
    
    button.secondary:hover {
      background-color: #4b5563;
    }
    
    button.success {
      background-color: #10b981;
    }
    
    button.success:hover {
      background-color: #059669;
    }
    
    button.warning {
      background-color: #f59e0b;
    }
    
    button.warning:hover {
      background-color: #d97706;
    }
    
    .theme-toggle {
      display: flex;
      margin: 15px 0;
    }
    
    .theme-option {
      padding: 8px 16px;
      cursor: pointer;
      border: 1px solid #d1d5db;
      margin-right: -1px;
    }
    
    .theme-option:first-child {
      border-radius: 4px 0 0 4px;
    }
    
    .theme-option:last-child {
      border-radius: 0 4px 4px 0;
    }
    
    .theme-option.active {
      background-color: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }
  </style>
</head>
<body>
  <h1>Sapientum AI Embed Test Suite</h1>
  <p>This page contains tests for the Sapientum AI embedding functionality.</p>
  
  <div class="test-container">
    <h2>Basic Embed Test</h2>
    <p>Tests the basic embedding functionality with default settings.</p>
    
    <div class="theme-toggle">
      <div class="theme-option light active" onclick="setTheme('light', this)">Light Theme</div>
      <div class="theme-option dark" onclick="setTheme('dark', this)">Dark Theme</div>
    </div>
    
    <div class="test-actions">
      <button id="load-embed-btn">Load Embed</button>
      <button id="resize-smaller-btn" class="secondary">Resize (500px height)</button>
      <button id="resize-larger-btn" class="secondary">Resize (800px height)</button>
      <button id="reload-embed-btn" class="warning">Reload</button>
    </div>
    
    <div id="embed-container" class="embed-container" style="height: 600px;">
      <p style="padding: 20px; text-align: center;">Embed will load here when you click "Load Embed"</p>
    </div>
    
    <h3>Message Exchange Test</h3>
    <div class="test-actions">
      <button id="send-ping-btn">Send Ping</button>
      <button id="navigate-console-btn">Navigate to Console</button>
      <button id="navigate-chat-btn">Navigate to Chat</button>
    </div>
    
    <h3>Test Results</h3>
    <div id="test-results" class="test-result">// Test results will appear here</div>
  </div>
  
  <!-- Include the embed script -->
  <script src="embed.js"></script>
  
  <script>
    let currentEmbed = null;
    let currentTheme = 'light';
    
    // Log to test results
    function log(message) {
      const results = document.getElementById('test-results');
      const timestamp = new Date().toLocaleTimeString();
      results.textContent += `[${timestamp}] ${message}\n`;
      results.scrollTop = results.scrollHeight;
    }
    
    // Set theme
    function setTheme(theme, element) {
      currentTheme = theme;
      
      // Update UI
      document.querySelectorAll('.theme-option').forEach(el => {
        el.classList.remove('active');
      });
      element.classList.add('active');
      
      // Update embed if it exists
      if (currentEmbed) {
        reloadEmbed();
      }
    }
    
    // Load embed
    function loadEmbed() {
      if (currentEmbed) {
        log('Embed already loaded. Destroying existing embed first.');
        currentEmbed.destroy();
      }
      
      log(`Loading embed with theme: ${currentTheme}`);
      
      try {
        currentEmbed = SapientumEmbed.create('#embed-container', {
          width: '100%',
          height: '600px',
          server: window.location.origin,
          theme: currentTheme,
          onReady: function(iframe) {
            log('âœ… Embed is ready');
          },
          onMessage: function(message) {
            log(`ðŸ“© Received message: ${JSON.stringify(message)}`);
          }
        });
        
        log('âœ… Embed created successfully');
      } catch (error) {
        log(`âŒ Error creating embed: ${error.message}`);
      }
    }
    
    // Reload embed
    function reloadEmbed() {
      if (currentEmbed) {
        currentEmbed.destroy();
        currentEmbed = null;
      }
      
      loadEmbed();
    }
    
    // Resize embed
    function resizeEmbed(height) {
      if (!currentEmbed) {
        log('âš ï¸ Embed not loaded yet');
        return;
      }
      
      try {
        currentEmbed.resize('100%', height);
        log(`âœ… Embed resized to ${height}`);
      } catch (error) {
        log(`âŒ Error resizing embed: ${error.message}`);
      }
    }
    
    // Send message to embed
    function sendMessage(type, data) {
      if (!currentEmbed) {
        log('âš ï¸ Embed not loaded yet');
        return;
      }
      
      const message = { type, ...data };
      
      try {
        currentEmbed.sendMessage(message);
        log(`ðŸ“¤ Sent message: ${JSON.stringify(message)}`);
      } catch (error) {
        log(`âŒ Error sending message: ${error.message}`);
      }
    }
    
    // Button click handlers
    document.getElementById('load-embed-btn').addEventListener('click', loadEmbed);
    document.getElementById('reload-embed-btn').addEventListener('click', reloadEmbed);
    document.getElementById('resize-smaller-btn').addEventListener('click', () => resizeEmbed('500px'));
    document.getElementById('resize-larger-btn').addEventListener('click', () => resizeEmbed('800px'));
    document.getElementById('send-ping-btn').addEventListener('click', () => {
      sendMessage('test', { ping: 'Hello from parent', timestamp: new Date().toISOString() });
    });
    document.getElementById('navigate-console-btn').addEventListener('click', () => {
      sendMessage('sapientum:navigate', { path: '/console' });
    });
    document.getElementById('navigate-chat-btn').addEventListener('click', () => {
      sendMessage('sapientum:navigate', { path: '/console/chat' });
    });
    
    // Initialize
    log('Test page loaded. Click "Load Embed" to begin testing.');
  </script>
</body>
</html>